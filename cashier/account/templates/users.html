{% extends "layouts/base.html" %}
{% load static %}
{% block content %}
    
    <h1 class="h3 mb-2 text-gray-800">Users</h1>
    
    <!-- DataTales Example -->
    <div class="card shadow mb-4">
        <div class="card-header py-3">
        
            <button class="btn btn-success" data-toggle="modal" data-target="#userModal">Add User</button>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table id="tb_user" class="table table-bordered dataTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Last Login</th>
                            <th>Super User</th>
                            <th>Staff</th>
                            <th>Active</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
        </div>
    </div>
<div class="col-md-6">

    <div class="card shadow mb-4">
        <div class="card-header py-3">
        
            <button type="button" class="btn btn-success form-group row" data-toggle="collapse" data-target="#collapsegroup">Add Group</button>
           
                <div class="collapse" id="collapsegroup">
                    <form class="form-inline" id="form_group">
                     <div class="form-group">
     
                         <label for="" class="col col-md-2">Group Name</label>
                         <input type="text" class="form-control" name="groupname" id="groupname" required>
                         <input type="submit" class="btn btn-primary" value="Save">
                     </div>
                    </form>
                   </div>
       
            
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table id="tb_group" class="table table-bordered dataTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Group Name</th>

                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
   <!-- Logout Modal-->
   <div class="modal fade" id="userModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
   aria-hidden="true">
   <div class="modal-dialog modal-dialog-centered" role="document">
       <div class="modal-content">
           <div class="modal-header">
               <h5 class="modal-title" id="exampleModalLabel">Create New User</h5>
               <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                   <span aria-hidden="true">Ã—</span>
               </button>
           </div>
           <div class="modal-body">
            <form role="form" method="POST" id="new-user">
                {% csrf_token %}
                
                <div class="form-group">
                    <label for="firs_name">First Name</label>
                    <input type="text" class="form-control" autocomplete="off" id="first_name" value="{{ users.first_name }}" name="first_name" placeholder="Enter first name">
                   
                </div>
                <div class="form-group">
                    <label for="last_name">Last Name</label>
                    <input type="text" class="form-control" autocomplete="off" id="last_name"  value="{{ users.last_name }}" name="last_name" placeholder="Enter last name">
                   
                </div>
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" class="form-control" id="username" autocomplete="off" value="{{ users.username }}" name="username" placeholder="Enter username">
                   
                </div>
                <div class="form-group">
                    <label for="email">Email address</label>
                    <input type="email" class="form-control" id="email"  value="{{ users.email }}" name="email" placeholder="Enter email">
                   
                </div>
                <div class="form-group">
                    <label for="groups">Groups</label>
                    <select class="select2 col-sm-12 form-control" id="groups" name="groups">
                        <option value="cashier">Cashier</option>
                        <option value="manager">Manager</option>
                       <option value="admin">Admin</option>
                    </select>
                   
                </div>
              
                <div class="form-group">
                    <label for="password">Password (Optional)</label>
                    <input type="password" class="form-control" id="password1" name="password1" placeholder="Password">
                    
                </div>
                <div class="form-group">
                    <label for="password">Retype password</label>
                    <input type="password" class="form-control" id="password2" name="password2" placeholder="Password">
                   
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success">Save</button>
                <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                
            </div>
        </form>
       </div>
   </div>
</div>
{% endblock %}
{% block javascript %}
   
   

    <!-- Core plugin JavaScript-->
   
    <!--<script src="{% static 'js/index-bundle.js' %}"></script>-->
    <script type="text/javascript">
        $(document).ready(function(){
         
            var tb_user = $("#tb_user").DataTable({
                processing: true,
                serverSide: true,
                searching: true,
                responsive: true,
                ordering: false,
                ajax: {
                        url: APP_URL+'/account/get-users',
                        type: "POST",
                        dataType: "json",
                        headers: {
                                    "X-Requested-With": "XMLHttpRequest",
                                    "X-CSRFToken": getCookie("csrftoken"),  // don't forget to include the 'getCookie' function
                                },
                        
                },
                columnDefs:[
                    {
                    targets: [7],
                    data: null,
                    
                    render: function(data , type, row, meta){
                                       
                                            return "<button class='btn-sm btn-success'><i class='fa fa-edit'></i></button>";
                                        
                                        }
                    }
                ],
                columns: [
                    { data: 'id', name: 'id' },
                    { data: 'username', name: 'username' },
                    { data: 'email', name: 'email' },
                    { data: 'last_login', name: 'last_login',render: function(data, type, row, meta){
                        if (data == null) {
                            return "";
                        }
                            return moment(data).format("YYYY-MM-DD h:mm:ss");
                    }},
                    { data: 'is_superuser', name: 'is_superuser', render: function(data, type, row, meta){
                            if (data == true) {
                                return "<i class='fa fa-check-circle' style='color:green'></i>"
                            }else{
                                return "<i class='fa fa-times-circle' style='color:red'></i>"
                            }
                    }},
                    { data: 'is_staff', name: 'is_staff', render: function(data, type, row, meta){
                            if (data == true) {
                                return "<i class='fa fa-check-circle' style='color:green'></i>"
                            }else{
                                return "<i class='fa fa-times-circle' style='color:red'></i>"
                            }
                    }},
                    { data: 'is_active', name: 'is_active', render: function(data, type, row, meta){
                            if (data == true) {
                                return "<i class='fa fa-check-circle' style='color:green'></i>"
                            }else{
                                return "<i class='fa fa-times-circle' style='color:red'></i>"
                            }
                    }},
                ]
            });
            
            $("#form_group").submit(function(e){
                e.preventDefault();
                alert("test");
            });
        });
    
    </script>
{% endblock javascript %}